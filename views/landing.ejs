<!DOCTYPE html>
<html>
<% var siteName = "AI Notebook" %>
<head><%= siteName %></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/stylesheets/app.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/landing.css">
    <link href="https://fonts.googleapis.com/css?family=Cutive+Mono" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script></head>
</head>
<body>
<div class="main-wallpaper fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark bg-transparent main-nav fixed-top px-0">
        <a class="navbar-brand ml-3" id="site-title" href="/"><%= siteName %></a>
        <button class="navbar-toggler mr-3" id="main-nav-toggler" type="button" data-toggle="collapse" data-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse text-center main-nav-menu" id="main-nav">
            <ul class="navbar-nav ml-auto">
                <% if (currentUser) { %>
                    <% if (currentUser.isAdmin) { %>
                        <li class="nav-item navbar-light mr-2">
                            <a class="nav-link disabled text-decoration-none" href="#" tabindex="-1" aria-disabled="true">Welcome, admin user <%= currentUser.username %></a>
                        </li>
                        <li class="nav-item mr-2"><a class="nav-link text-white" href="/quotes">Quotes</a></li>
                    <% } %>
                    <li class="nav-item mr-2"><a class="nav-link text-white" href="/home">Home</a></li>
                    <li class="nav-item mr-2"><a class="nav-link text-white" href="/entries">Entries</a></li>
                    <li class="nav-item mr-2"><a class="nav-link text-white" href="/account">Account</a></li>
                    <li class="nav-item mr-3"><a class="nav-link text-white" href="/logout">Logout</a></li>
                <% } else { %>
                    <li class="nav-item mr-2"><a class="nav-link text-white" href="/about">About</a></li>
                    <li class="nav-item mr-3"><a class="login-btn btn btn-outline-light nav-link text-white" href="/login">Log In</a></li>
                <% } %>
            </ul>
        </div>
    </nav>
    <div class="landing-content-clipper">
        <!-- Sits in the middle of the jumbotron-like area and scrolls with main content -->
        <div class="container-fluid title-container text-center text-white">
            <h1 class="mb-5">Get more out of your journal.</h1>
            <a href="/register" class="btn call-to-action-btn btn-lg mb-2">Sign up for free</a><br>
        </div>

        <!-- Contains all white-background scrolling content -->
        <div class="content-container bg-white">
            <div class="container pt-5">
                <div class="row mb-4 align-items-center justify-content-center">
                    <div class="col-11 col-lg-8 py-5 text-center">
                        <h2>It's time for a smarter online journal.</h2>
                        <p class="text-secondary"><%= siteName %> is an online journal with everything you need and nothing you don't.</p>
                    </div>
                </div>
                <div class="row mb-5 align-items-center justify-content-center">
                    <div class="col-11 col-md-7 order-md-12 text-center">
                        <h2>Tagging System</h2>
                        <p class="text-secondary">Put tags on entries to easily categorize them. Then sort by tag to group related entries.</p>
                    </div>
                    <div class="col-10 col-sm-8 col-md-5 order-md-1">
                        <img class="img-fluid px-md-5 border" src="/images/tagshelp1.png" alt="">
                    </div>
                </div>
                <div class="row mb-5 align-items-center justify-content-center">
                    <div class="col-11 col-md-7 text-center">
                        <h2>Powerful Search</h2>
                        <p class="text-secondary">No more looking through journal entries to find what you need. <%= siteName %> allows you to search for people, places, and ideas so you can find exactly what you want, instantly.</p>
                    </div>
                    <div class="col-10 col-sm-8 col-md-5">
                        <img class="img-fluid px-md-5 border" src="/images/tagshelp2.png" alt="">
                    </div>
                </div>
            
                <div class="jumbotron mb-5 text-center">
                    <div class="row">
                        <div class="col px-5 my-5">
                            <blockquote class="blockquote"><h3>"I'm never going back to a paper journal."</h3></blockquote>
                            <p>-Anonymous user</p>
                        </div>
                    </div>
                </div>
            </div> <!-- container -->

            <div class="container-fluid mt-5 bg-dark text-light">
                <div class="row align-items-center justify-content-center">
                    <div class="col-12 col-md-6 col-lg-5 text-center pt-4">
                        <h3>Start your writing journey now.</h3>
                        <p>Signing up while the app is in beta means your account is free, forever.</p>
                    </div>
                    <div class="col-11 col-md-6 col-lg-4 p-3 rounded">
                        <% if (error && error.length > 0) { %>
                            <div class="alert alert-danger mt-3 alert-dismissible fade show" id="signup-error-alert">
                                <strong>Error: </strong>
                                <%= error %>
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                        <% } %>
                        <form class="form-group needs-validation <%= error && error.length > 0 ? "was-validated" : "" %>" action="/register" method="POST" id="signup-form" novalidate>
                            <div class="form-group pt-3">
                                <label class="mb-1" for="username">Username:</label>
                                <input class="form-control" type="text" placeholder="Type your username" name="username" id="username" required aria-describedby="email-feedback">
                                <div id="email-feedback" class="invalid-feedback"></div>
                            </div>
                            <div class="form-group">
                                <label class="mb-1" for="password">Password:</label>
                                <input class="form-control" type="password" placeholder="Type a password..." name="password" id="password" aria-describedby="password-feedback" required>
                                <div id="password-feedback" class="invalid-feedback"></div>
                            </div>
                            <div class="form-group">
                                <label class="mb-1" for="confirm-password">Confirm Password:</label>
                                <input class="form-control" type="password" placeholder="Repeat password..." name="password2" id="confirm-password" aria-describedby="confirm-password-feedback" required>
                                <div id="confirm-password-feedback" class="invalid-feedback"></div>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="terms" id="tc" required>
                                <label class="form-check-label" for="terms-checkbox" aria-describedby="tc-feedback">I agree to the <a href="/terms" target="_blank" style="color: inherit"><u>terms and conditions</u></a></label>
                                <div id="tc-feedback" class="invalid-feedback"></div>
                            </div>
                            <div class="text-center mt-4">
                                <button class="btn btn-primary w-100 text-center">Sign Up</button>
                                <br>
                                <a class="d-inline-block text-center pt-2" href="/login">Or log in instead</a>     
                            </div>   
                        </form>      
                    </div>      
                </div> <!-- row -->
            </div>
        </div> <!-- content-container -->
    </div> <!-- landing-content-clipper -->
</div> <!-- main-wallpaper -->

<script>
    // Much borrowed from the examples at https://developer.mozilla.org/en-US/docs/Learn/Forms/Form_validation
    'use strict';
    window.addEventListener('load', function() {
        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        var form = document.getElementsByClassName('needs-validation')[0];
        const email = document.getElementById("username");
        const emailFeedback = document.getElementById("email-feedback");
        const password = document.getElementById("password");
        const passwordFeedback = document.getElementById('password-feedback');
        const confirmPassword = document.getElementById("confirm-password");
        const confirmPasswordFeedback = document.getElementById('confirm-password-feedback');
        const tc = document.getElementById("tc");
        const tcFeedback = document.getElementById('tc-feedback');

        // This function doesn't show good separation of concerns but I am too tired to engineer a better solution
        const displayFeedback = function(element, feedbackElement, fieldName, isValid) {
            if (isValid) {
                element.classList.remove("is-invalid");
                element.classList.add("is-valid");
                feedbackElement.textContent = ''; // Reset the content of the message
            } else {
                // set error message based on the feedback from the browser constraint validation API and/or custom rules
                if(element.validity.valueMissing) {
                    feedbackElement.textContent = `${fieldName} cannot be empty.`;
                } else if(element.validity.typeMismatch) {
                    feedbackElement.textContent = `${fieldName} is invalid.`;
                } else if (element.id === "confirm-password" && confirmPassword.value !== password.value) {
                    feedbackElement.textContent = `Passwords must match.`;
                } else {
                    feedbackElement.textContent = `Something else.`;
                }
                element.classList.remove("is-valid");
                element.classList.add("is-invalid");
            }
        }

        // Custom validation function for email field
        const emailIsValid = function() {
            return email.validity.valid;
        };

        email.addEventListener('input', function (event) {
            displayFeedback(email, emailFeedback, "Email", emailIsValid());
        });

        // Custom validation function for password field
        const passwordIsValid = function() {
            return password.validity.valid;
        };

        password.addEventListener('input', function (event) {
            displayFeedback(password, passwordFeedback, "Password", passwordIsValid());
            displayFeedback(confirmPassword, confirmPasswordFeedback, "Field", confirmPasswordIsValid());
        });

        // Custom validation function for password confirm field
        const confirmPasswordIsValid = function() {
            return confirmPassword.validity.valid && confirmPassword.value === password.value;
        };

        confirmPassword.addEventListener('input', function (event) {
            displayFeedback(confirmPassword, confirmPasswordFeedback, "Field", confirmPasswordIsValid());
        });

        // Custom validation function for terms and conditions field
        const tcIsValid = function() {
            console.log(tc.validity.valid);
            return tc.validity.valid;
        };

        tc.addEventListener('change', function (event) {
            console.log("Changed.");
            displayFeedback(tc, tcFeedback, "Field", tcIsValid());
        });

        form.addEventListener('submit', function(event) {
            if (form.checkValidity() === false || !emailIsValid || !passwordIsValid || !confirmPasswordIsValid || !tcIsValid) {
                event.preventDefault();
                event.stopPropagation();
                displayFeedback(email, emailFeedback, "Email", emailIsValid());
                displayFeedback(password, passwordFeedback, "Password", passwordIsValid());
                displayFeedback(confirmPassword, confirmPasswordFeedback, "Field", confirmPasswordIsValid());
                displayFeedback(tc, tcFeedback, "Field", tcIsValid());
            }
            // let it submit
        }, false);
    }, false);
</script>


<%# if there is a signup error, scroll to the signup form %>
<% if (error && error.length > 0) { %>
    <script>
        document.querySelector("#signup-form").scrollIntoView();
    </script>
<% } %>

